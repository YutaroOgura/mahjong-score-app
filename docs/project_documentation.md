# 麻雀収支計算アプリケーション - プロジェクト構成資料

## 1. システム概要

麻雀収支計算アプリケーションは、麻雀の対局結果を記録し、プレイヤーごとの収支や統計情報を管理するためのウェブアプリケーションです。ユーザーは対局情報（日時、場所、ゲームタイプなど）と各プレイヤーの成績（着順、得点）を入力することで、自動的に収支計算が行われ、プレイヤーごとの統計情報が更新されます。

### 主な特徴

- 対局結果の記録と管理
- プレイヤー情報の管理
- 自動的な収支計算（ウマ計算を含む）
- プレイヤーごとの統計情報の表示
- 対局履歴の閲覧と検索

### 技術スタック

- **バックエンド**: PHP 8.1, Laravel 10
- **フロントエンド**: Vue.js 3, Tailwind CSS
- **データベース**: MySQL 8.0
- **ウェブサーバー**: Apache
- **開発環境**: Docker, Docker Compose

## 2. 全体構成図・アーキテクチャ

```
┌─────────────────────────────────────────────────────────────────┐
│                      クライアント (ブラウザ)                      │
└───────────────────────────────┬─────────────────────────────────┘
                                │
                                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         Webサーバー (Apache)                     │
└───────────────────────────────┬─────────────────────────────────┘
                                │
                                ▼
┌─────────────────────────────────────────────────────────────────┐
│                      Laravel アプリケーション                     │
│                                                                 │
│  ┌─────────────┐    ┌─────────────┐    ┌─────────────────────┐  │
│  │  Vue.js     │    │  Controllers │    │  Models             │  │
│  │  フロントエンド │    │  - Game      │    │  - Game            │  │
│  │  - ホーム     │    │  - Player    │    │  - Player          │  │
│  │  - 対局一覧   │    │              │    │  - GameResult      │  │
│  │  - プレイヤー  │    │              │    │                     │  │
│  └─────────────┘    └─────────────┘    └─────────────────────┘  │
│                                                                 │
└───────────────────────────────┬─────────────────────────────────┘
                                │
                                ▼
┌─────────────────────────────────────────────────────────────────┐
│                       データベース (MySQL)                        │
│                                                                 │
│  ┌─────────────┐    ┌─────────────┐    ┌─────────────────────┐  │
│  │  games      │    │  players    │    │  game_results       │  │
│  └─────────────┘    └─────────────┘    └─────────────────────┘  │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### アーキテクチャの説明

#### フロントエンド (Vue.js)
- **SPA (Single Page Application)** アーキテクチャを採用
- **Vue Router** によるルーティング管理
- **Axios** によるAPIリクエスト処理
- **Tailwind CSS** によるUIデザイン

#### バックエンド (Laravel)
- **MVC (Model-View-Controller)** アーキテクチャを採用
- **RESTful API** によるフロントエンドとの通信
- **Eloquent ORM** によるデータベース操作
- **ミドルウェア** によるリクエスト処理

#### データベース (MySQL)
- リレーショナルデータベースによるデータ管理
- 外部キー制約によるデータ整合性の確保
- インデックスによるクエリパフォーマンスの最適化

## 3. 機能一覧

### 対局管理機能
| 機能ID | 機能名 | 説明 |
|--------|--------|------|
| G-01 | 対局一覧表示 | 記録された対局の一覧を表示する。ページネーション機能付き。 |
| G-02 | 対局詳細表示 | 特定の対局の詳細情報（日時、場所、プレイヤー、得点など）を表示する。 |
| G-03 | 対局登録 | 新しい対局情報を登録する。プレイヤー、得点、ウマなどを設定可能。 |
| G-04 | 対局編集 | 既存の対局情報を編集する。 |
| G-05 | 対局削除 | 対局情報を削除する。関連する統計情報も自動的に更新される。 |

### プレイヤー管理機能
| 機能ID | 機能名 | 説明 |
|--------|--------|------|
| P-01 | プレイヤー一覧表示 | 登録されたプレイヤーの一覧を表示する。 |
| P-02 | プレイヤー詳細表示 | プレイヤーの詳細情報と統計データを表示する。 |
| P-03 | プレイヤー登録 | 新しいプレイヤーを登録する。 |
| P-04 | プレイヤー編集 | プレイヤー情報を編集する。 |
| P-05 | プレイヤー削除 | プレイヤー情報を削除する（ソフトデリート）。 |

### 統計・分析機能
| 機能ID | 機能名 | 説明 |
|--------|--------|------|
| S-01 | プレイヤー統計表示 | プレイヤーごとの総合成績（総対局数、総得点、平均順位など）を表示する。 |
| S-02 | 順位分布表示 | プレイヤーごとの順位分布を表示する。 |
| S-03 | 月別成績表示 | 月ごとの成績推移を表示する。 |

### システム機能
| 機能ID | 機能名 | 説明 |
|--------|--------|------|
| SYS-01 | レスポンシブデザイン | モバイル端末からも利用可能なレスポンシブなUI設計。 |
| SYS-02 | データバックアップ | データベースのバックアップ機能。 |

## 4. 機能相関マトリックス

以下のマトリックスは、各機能間の関連性を示しています。「●」は強い関連性、「○」は弱い関連性を表します。

| 機能ID | G-01 | G-02 | G-03 | G-04 | G-05 | P-01 | P-02 | P-03 | P-04 | P-05 | S-01 | S-02 | S-03 |
|--------|------|------|------|------|------|------|------|------|------|------|------|------|------|
| G-01 | - | ● | ○ | ○ | ○ | ○ | ○ | | | | ○ | | ○ |
| G-02 | ● | - | | ● | ● | | ○ | | | | | | |
| G-03 | ○ | | - | | | ○ | | | | | ● | ● | ● |
| G-04 | ○ | ● | | - | ○ | | | | | | ○ | ○ | ○ |
| G-05 | ○ | ● | | ○ | - | | | | | | ● | ● | ● |
| P-01 | ○ | | ○ | | | - | ● | ○ | ○ | ○ | ○ | | |
| P-02 | ○ | ○ | | | | ● | - | | ● | ● | ● | ● | ● |
| P-03 | | | | | | ○ | | - | | | | | |
| P-04 | | | | | | ○ | ● | | - | ○ | | | |
| P-05 | | | | | | ○ | ● | | ○ | - | | | |
| S-01 | ○ | | ● | ○ | ● | ○ | ● | | | | - | ● | ● |
| S-02 | | | ● | ○ | ● | | ● | | | | ● | - | ○ |
| S-03 | ○ | | ● | ○ | ● | | ● | | | | ● | ○ | - |

## 5. データモデル

### ER図

```
┌───────────────┐      ┌───────────────┐      ┌───────────────┐
│    players    │      │ game_results  │      │    games      │
├───────────────┤      ├───────────────┤      ├───────────────┤
│ id            │      │ id            │      │ id            │
│ name          │      │ game_id       │◄─────┤ played_at     │
│ nickname      │      │ player_id     │◄─────┤ location      │
│ total_games   │      │ seat          │      │ game_type     │
│ total_points  │      │ rank          │      │ uma_1st       │
│ average_rank  │      │ points        │      │ uma_2nd       │
│ created_at    │      │ score         │      │ uma_3rd       │
│ updated_at    │      │ created_at    │      │ uma_4th       │
│ deleted_at    │      │ updated_at    │      │ starting_points│
└───────────────┘      └───────────────┘      │ note          │
                                              │ created_at    │
                                              │ updated_at    │
                                              │ deleted_at    │
                                              └───────────────┘
```

### テーブル定義

#### players テーブル
- **id**: プレイヤーID (主キー)
- **name**: プレイヤー名
- **nickname**: ニックネーム (オプション)
- **total_games**: 総対局数
- **total_points**: 総得点
- **average_rank**: 平均順位
- **created_at**: 作成日時
- **updated_at**: 更新日時
- **deleted_at**: 削除日時 (ソフトデリート用)

#### games テーブル
- **id**: 対局ID (主キー)
- **played_at**: 対局日時
- **location**: 対局場所 (オプション)
- **game_type**: ゲームタイプ (東風戦/東南戦)
- **uma_1st**: 1位のウマ
- **uma_2nd**: 2位のウマ
- **uma_3rd**: 3位のウマ
- **uma_4th**: 4位のウマ
- **starting_points**: 配給原点
- **note**: メモ (オプション)
- **created_at**: 作成日時
- **updated_at**: 更新日時
- **deleted_at**: 削除日時 (ソフトデリート用)

#### game_results テーブル
- **id**: 結果ID (主キー)
- **game_id**: 対局ID (外部キー)
- **player_id**: プレイヤーID (外部キー)
- **seat**: 席順 (0:東, 1:南, 2:西, 3:北)
- **rank**: 順位 (1-4)
- **points**: 得点
- **score**: 最終スコア (ウマ込み)
- **created_at**: 作成日時
- **updated_at**: 更新日時

## 6. 技術的特徴

### セキュリティ対策
- **CSRF保護**: Laravelの組み込みCSRF保護機能を使用
- **バリデーション**: すべてのユーザー入力に対する厳格なバリデーション
- **SQLインジェクション対策**: Eloquent ORMによるパラメータ化クエリの使用

### パフォーマンス最適化
- **データベースインデックス**: 頻繁に検索されるカラムにインデックスを設定
- **クエリ最適化**: N+1問題を回避するためのEagerローディングの使用
- **キャッシュ**: 頻繁にアクセスされるデータのキャッシュ

### 拡張性
- **モジュラー設計**: 機能ごとにモジュール化された設計
- **APIベースのアーキテクチャ**: フロントエンドとバックエンドの分離
- **コンテナ化**: Dockerによる環境の標準化と移植性の確保
